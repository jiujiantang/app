"use strict";var f=Object.defineProperty;var m=(i,t,e)=>t in i?f(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var o=(i,t,e)=>(m(i,typeof t!="symbol"?t+"":t,e),e);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const a=require("vue");class g{constructor(){o(this,"handlers",new Map)}on(t,e){return this.handlers.has(t)||this.handlers.set(t,new Set),this.handlers.get(t).add(e),()=>this.off(t,e)}once(t,e){const n=r=>{try{e(r)}finally{this.off(t,n)}};return this.on(t,n)}off(t,e){if(!e){this.handlers.delete(t);return}const n=this.handlers.get(t);n&&(n.delete(e),n.size===0&&this.handlers.delete(t))}emit(t,e){const n=this.handlers.get(t);n&&Array.from(n).forEach(r=>{try{r(e)}catch{}})}}class p{constructor(t=1e3){o(this,"events",new g);o(this,"endTime",0);o(this,"timerId",null);o(this,"interval");o(this,"running",!1);this.interval=Math.max(16,t)}set(t){this.endTime=t,this.events.emit("set",t)}start(t){if(typeof t=="number"&&(this.endTime=t),!this.endTime)throw new Error("endTime not set");this.running||(this.running=!0,this.events.emit("start",this.endTime),this.tick(),this.timerId=window.setInterval(()=>this.tick(),this.interval))}tick(){const t=Date.now(),e=Math.max(0,this.endTime-t);this.events.emit("tick",e),e<=0&&(this.stopTimer(),this.events.emit("end"),this.running=!1)}pause(){this.running&&(this.stopTimer(),this.running=!1,this.events.emit("pause"))}resume(){this.running||!this.endTime||(this.running=!0,this.events.emit("resume"),this.tick(),this.timerId=window.setInterval(()=>this.tick(),this.interval))}stop(){this.stopTimer(),this.endTime=0,this.running=!1}isRunning(){return this.running}stopTimer(){this.timerId!==null&&(clearInterval(this.timerId),this.timerId=null)}}class v{constructor(t=1e3){o(this,"cores",new Map);o(this,"interval");this.interval=t}getCore(t){return this.cores.has(t)||this.cores.set(t,new p(this.interval)),this.cores.get(t)}deleteCore(t){const e=this.cores.get(t);e&&(e.stop(),this.cores.delete(t))}clear(){this.cores.forEach(t=>t.stop()),this.cores.clear()}}const d=new v(1e3);function w(i){const t=Math.floor(i/1e3),e=t%60,n=Math.floor(t/60)%60,r=Math.floor(t/3600)%24,h=Math.floor(t/86400),l=String(e).padStart(2,"0"),u=String(n).padStart(2,"0"),s=String(r).padStart(2,"0");return`${String(h)},${s},${u},${l}`}const S=a.defineComponent({__name:"Countdown",props:{keyName:{type:String,required:!0},end:{type:Number,required:!0},autoStart:{type:Boolean,default:!0},onFinish:{type:Function,default:null}},setup(i){const t=i,e=a.ref(""),n=a.ref(0);let r,h=null,l=null;function u(s){typeof s<"u"&&s>=0&&(e.value=w(s),n.value=s)}return a.onMounted(()=>{r=d.getCore(t.keyName),r.set(t.end),h=r.events.on("tick",u),l=r.events.on("end",()=>{t.onFinish(t.keyName)}),t.autoStart&&r.start(),a.watch(()=>t.end,s=>{r.set(s),r.isRunning()||r.start()})}),a.onBeforeUnmount(()=>{h==null||h(),l==null||l(),d.deleteCore(t.keyName)}),(s,c)=>a.renderSlot(s.$slots,"default",{time:e.value,left:n.value},()=>[a.createTextVNode(a.toDisplayString(e.value),1)])}});exports.countdownManager=d;exports.default=S;
